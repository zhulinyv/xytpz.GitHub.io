"undefined" == typeof window.define && (window.define = function() {}, window.define.amd = 1), "undefined" == typeof window.$AJB && (window.$AJB = {}), $AJB.lib = {}, $AJB.general = {}, $AJB.page = {},
    function(a) {
        "use strict";

        function b(a, b) {
            var c = (65535 & a) + (65535 & b),
                d = (a >> 16) + (b >> 16) + (c >> 16);
            return d << 16 | 65535 & c
        }

        function c(a, b) {
            return a << b | a >>> 32 - b
        }

        function d(a, d, e, f, g, h) {
            return b(c(b(b(d, a), b(f, h)), g), e)
        }

        function e(a, b, c, e, f, g, h) {
            return d(b & c | ~b & e, a, b, f, g, h)
        }

        function f(a, b, c, e, f, g, h) {
            return d(b & e | c & ~e, a, b, f, g, h)
        }

        function g(a, b, c, e, f, g, h) {
            return d(b ^ c ^ e, a, b, f, g, h)
        }

        function h(a, b, c, e, f, g, h) {
            return d(c ^ (b | ~e), a, b, f, g, h)
        }

        function i(a, c) {
            a[c >> 5] |= 128 << c % 32, a[(c + 64 >>> 9 << 4) + 14] = c;
            var d, i, j, k, l, m = 1732584193,
                n = -271733879,
                o = -1732584194,
                p = 271733878;
            for (d = 0; d < a.length; d += 16) i = m, j = n, k = o, l = p, m = e(m, n, o, p, a[d], 7, -680876936), p = e(p, m, n, o, a[d + 1], 12, -389564586), o = e(o, p, m, n, a[d + 2], 17, 606105819), n = e(n, o, p, m, a[d + 3], 22, -1044525330), m = e(m, n, o, p, a[d + 4], 7, -176418897), p = e(p, m, n, o, a[d + 5], 12, 1200080426), o = e(o, p, m, n, a[d + 6], 17, -1473231341), n = e(n, o, p, m, a[d + 7], 22, -45705983), m = e(m, n, o, p, a[d + 8], 7, 1770035416), p = e(p, m, n, o, a[d + 9], 12, -1958414417), o = e(o, p, m, n, a[d + 10], 17, -42063), n = e(n, o, p, m, a[d + 11], 22, -1990404162), m = e(m, n, o, p, a[d + 12], 7, 1804603682), p = e(p, m, n, o, a[d + 13], 12, -40341101), o = e(o, p, m, n, a[d + 14], 17, -1502002290), n = e(n, o, p, m, a[d + 15], 22, 1236535329), m = f(m, n, o, p, a[d + 1], 5, -165796510), p = f(p, m, n, o, a[d + 6], 9, -1069501632), o = f(o, p, m, n, a[d + 11], 14, 643717713), n = f(n, o, p, m, a[d], 20, -373897302), m = f(m, n, o, p, a[d + 5], 5, -701558691), p = f(p, m, n, o, a[d + 10], 9, 38016083), o = f(o, p, m, n, a[d + 15], 14, -660478335), n = f(n, o, p, m, a[d + 4], 20, -405537848), m = f(m, n, o, p, a[d + 9], 5, 568446438), p = f(p, m, n, o, a[d + 14], 9, -1019803690), o = f(o, p, m, n, a[d + 3], 14, -187363961), n = f(n, o, p, m, a[d + 8], 20, 1163531501), m = f(m, n, o, p, a[d + 13], 5, -1444681467), p = f(p, m, n, o, a[d + 2], 9, -51403784), o = f(o, p, m, n, a[d + 7], 14, 1735328473), n = f(n, o, p, m, a[d + 12], 20, -1926607734), m = g(m, n, o, p, a[d + 5], 4, -378558), p = g(p, m, n, o, a[d + 8], 11, -2022574463), o = g(o, p, m, n, a[d + 11], 16, 1839030562), n = g(n, o, p, m, a[d + 14], 23, -35309556), m = g(m, n, o, p, a[d + 1], 4, -1530992060), p = g(p, m, n, o, a[d + 4], 11, 1272893353), o = g(o, p, m, n, a[d + 7], 16, -155497632), n = g(n, o, p, m, a[d + 10], 23, -1094730640), m = g(m, n, o, p, a[d + 13], 4, 681279174), p = g(p, m, n, o, a[d], 11, -358537222), o = g(o, p, m, n, a[d + 3], 16, -722521979), n = g(n, o, p, m, a[d + 6], 23, 76029189), m = g(m, n, o, p, a[d + 9], 4, -640364487), p = g(p, m, n, o, a[d + 12], 11, -421815835), o = g(o, p, m, n, a[d + 15], 16, 530742520), n = g(n, o, p, m, a[d + 2], 23, -995338651), m = h(m, n, o, p, a[d], 6, -198630844), p = h(p, m, n, o, a[d + 7], 10, 1126891415), o = h(o, p, m, n, a[d + 14], 15, -1416354905), n = h(n, o, p, m, a[d + 5], 21, -57434055), m = h(m, n, o, p, a[d + 12], 6, 1700485571), p = h(p, m, n, o, a[d + 3], 10, -1894986606), o = h(o, p, m, n, a[d + 10], 15, -1051523), n = h(n, o, p, m, a[d + 1], 21, -2054922799), m = h(m, n, o, p, a[d + 8], 6, 1873313359), p = h(p, m, n, o, a[d + 15], 10, -30611744), o = h(o, p, m, n, a[d + 6], 15, -1560198380), n = h(n, o, p, m, a[d + 13], 21, 1309151649), m = h(m, n, o, p, a[d + 4], 6, -145523070), p = h(p, m, n, o, a[d + 11], 10, -1120210379), o = h(o, p, m, n, a[d + 2], 15, 718787259), n = h(n, o, p, m, a[d + 9], 21, -343485551), m = b(m, i), n = b(n, j), o = b(o, k), p = b(p, l);
            return [m, n, o, p]
        }

        function j(a) {
            var b, c = "";
            for (b = 0; b < 32 * a.length; b += 8) c += String.fromCharCode(a[b >> 5] >>> b % 32 & 255);
            return c
        }

        function k(a) {
            var b, c = [];
            for (c[(a.length >> 2) - 1] = void 0, b = 0; b < c.length; b += 1) c[b] = 0;
            for (b = 0; b < 8 * a.length; b += 8) c[b >> 5] |= (255 & a.charCodeAt(b / 8)) << b % 32;
            return c
        }

        function l(a) {
            return j(i(k(a), 8 * a.length))
        }

        function m(a, b) {
            var c, d, e = k(a),
                f = [],
                g = [];
            for (f[15] = g[15] = void 0, e.length > 16 && (e = i(e, 8 * a.length)), c = 0; 16 > c; c += 1) f[c] = 909522486 ^ e[c], g[c] = 1549556828 ^ e[c];
            return d = i(f.concat(k(b)), 512 + 8 * b.length), j(i(g.concat(d), 640))
        }

        function n(a) {
            var b, c, d = "0123456789abcdef",
                e = "";
            for (c = 0; c < a.length; c += 1) b = a.charCodeAt(c), e += d.charAt(b >>> 4 & 15) + d.charAt(15 & b);
            return e
        }

        function o(a) {
            return unescape(encodeURIComponent(a))
        }

        function p(a) {
            return l(o(a))
        }

        function q(a) {
            return n(p(a))
        }

        function r(a, b) {
            return m(o(a), o(b))
        }

        function s(a, b) {
            return n(r(a, b))
        }

        function t(a, b, c) {
            return b ? c ? r(b, a) : s(b, a) : c ? p(a) : q(a)
        }
        "function" == typeof define && define.amd ? $AJB.lib.md5 = function() {
            return t
        } : a.md5 = t
    }(this), $AJB.general.LevelCode = function() {
        "use strict";
        var a, b = $AJB.lib.md5(),
            c = "Handsome",
            d = {},
            e = 60;
        for (a = 1; e >= a; a++) d[b(a + c)] = a;
        return {
            encode: function(a) {
                var b;
                for (b in d)
                    if (d[b] == a) return b
            },
            decode: function(a) {
                return d[a]
            }
        }
    }, $AJB.lib.stopEvent = function() {
        "use strict";
        return function(a) {
            a && (a.preventDefault ? (a.preventDefault(), a.stopPropagation()) : (a.returnValue = !1, a.cancelBubble = !0))
        }
    }, $AJB.lib.Storage = function() {
        "use strict";
        var a = {
            setValue: function(a, b) {
                try {
                    window.localStorage && (window.localStorage[a] = b)
                } catch (c) {}
            },
            getValue: function(a) {
                if (window.localStorage) try {
                    return window.localStorage[a]
                } catch (b) {}
            }
        };
        return a
    }, $AJB.lib.tip = function() {
        "use strict";
        var a = $AJB.lib["class"](),
            b = document.getElementById("tips"),
            c = {
                popup: function(c) {
                    b.innerHTML = c, a.addClass(b, "fadein"), setTimeout(function() {
                        b.className = ""
                    }, 2e3)
                },
                show: function(c) {
                    b.innerHTML = c, a.addClass(b, "show")
                },
                hide: function(a) {
                    b.innerHTML = a, setTimeout(function() {
                        b.className = ""
                    }, 2e3)
                }
            };
        return c
    }, $AJB.lib.ajax = function() {
        "use strict";

        function a() {
            if ("undefined" != typeof XMLHttpRequest) return new XMLHttpRequest;
            for (var a, b = ["MSXML2.XmlHttp.5.0", "MSXML2.XmlHttp.4.0", "MSXML2.XmlHttp.3.0", "MSXML2.XmlHttp.2.0", "Microsoft.XmlHttp"], c = 0; c < b.length; c++) try {
                a = new ActiveXObject(b[c]);
                break
            } catch (d) {}
            return a
        }

        function b(b, c, d, e, f) {
            var g = a();
            g.open(d, b, f), g.onreadystatechange = function() {
                4 == g.readyState && c(g.responseText)
            }, "POST" == d && g.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), g.send(e)
        }
        return {
            get: function(a, c, d, e) {
                var f = [];
                for (var g in c) f.push(encodeURIComponent(g) + "=" + encodeURIComponent(c[g]));
                b(a + "?" + f.join("&"), d, "GET", null, e)
            },
            post: function(a, c, d, e) {
                var f = [];
                for (var g in c) f.push(encodeURIComponent(g) + "=" + encodeURIComponent(c[g]));
                b(a, d, "POST", f.join("&"), e)
            }
        }
    }, $AJB.general.GameInfo = function() {
        "use strict";
        var a = $AJB.lib.ajax(),
            b = $AJB.lib.util(),
            c = $AJB.lib.tip(),
            d = {
                save: function(d) {
                    a.post("http://timelineapp.pointstone.org/ci/authorize/save_level", {
                        openid: b.getOpenid(),
                        level: d
                    }, function() {
                        c.popup("已保存第" + d + "关")
                    }, !0)
                },
                jump: function(d) {
                    a.post("http://timelineapp.pointstone.org/ci/authorize/save_jumplevel", {
                        openid: b.getOpenid(),
                        level: d
                    }, function() {
                        c.popup("已同步跳关数据")
                    }, !0)
                },
                load: function(b, c) {
                    a.post("http://timelineapp.pointstone.org/ci/authorize/read_usergameinfo", {
                        openid: b
                    }, function(a) {
                        c(a)
                    }, !0)
                },
                is_subscribe: function(b, c) {
                    a.post("http://timelineapp.pointstone.org/ci/authorize/is_subscribe", {
                        openid: b
                    }, function(a) {
                        var a = JSON.parse(a);
                        c(a.code)
                    }, !0)
                }
            };
        return d
    }, $AJB.lib["class"] = function() {
        "use strict";
        return {
            hasClass: function(a, b) {
                if (a) {
                    var c = a.className;
                    return 0 == c.length ? !1 : c == b || c.match(new RegExp("(^|\\s)" + b + "(\\s|$)")) ? !0 : !1
                }
            },
            addClass: function(a, b) {
                if (a) {
                    var c = a.className;
                    return 0 == c.length ? void(a.className = b) : void(c == b || c.match(new RegExp("(^|\\s)" + b + "(\\s|$)")) || (a.className = c + " " + b))
                }
            },
            removeClass: function(a, b) {
                if (a) {
                    var c = a.className;
                    if (0 != c.length) return c == b ? void(a.className = "") : void(c.match(new RegExp("(^|\\s)" + b + "(\\s|$)")) && (a.className = c.replace(new RegExp("(^|\\s)" + b + "(\\s|$)"), " ")))
                }
            },
            show: function(a) {
                a.style.display = ""
            },
            showInline: function(a) {
                a.style.display = "inline-block"
            },
            hide: function(a) {
                a.style.display = "none"
            }
        }
    }, $AJB.general.BeginStage = function() {
        "use strict";

        function a(a) {
            function c() {
                b(i, "click", function() {
                    f.fire(h, g)
                }), k.innerHTML = d.isAndroid ? "GO" : "▶"
            }
            var i = a.getElementsByClassName("button")[0],
                j = a.getElementsByClassName("text")[0],
                k = document.getElementById("txtAr"),
                l = {
                    show: function() {
                        a.style.display = ""
                    },
                    hide: function() {
                        a.style.display = "none"
                    },
                    level: function(a, c) {
                        var d = a,
                            c = c ? c : 0;
                        j.innerHTML = "level " + a;
                        var g = document.getElementById("levelProgressBar"),
                            i = 80 * a / 90 + "px";
                        g.style.width = i;
                        for (var k = "", l = 0; 2 >= l; l++) {
                            k += l != c ? '<div class="page page_' + (l + 1) + '">' : '<div class="page page_' + (l + 1) + ' show">';
                            for (var m = 0; 5 >= m; m++) {
                                var n = "",
                                    o = 30 * l + 5 * m;
                                n += '<div class="row">', n += '<div data-level="' + (o + 1) + '" class="block lv_' + (o + 1) + '">' + (o + 1) + "</div>", n += '<div data-level="' + (o + 2) + '" class="block lv_' + (o + 2) + '">' + (o + 2) + "</div>", n += '<div data-level="' + (o + 3) + '" class="block lv_' + (o + 3) + '">' + (o + 3) + "</div>", n += '<div data-level="' + (o + 4) + '" class="block lv_' + (o + 4) + '">' + (o + 4) + "</div>", n += '<div data-level="' + (o + 5) + '" class="block lv_' + (o + 5) + '">' + (o + 5) + "</div>", n += "</div>", k += n
                            }
                            k += "</div>"
                        }
                        chooseBlock.innerHTML = k;
                        for (var p = document.getElementsByClassName("block"), m = 0; m < p.length; m++) d > m && (e.addClass(p[m], "passed"), b(p[m], "mousedown", function(a) {
                            f.fire(h, a.target.dataset.level)
                        }))
                    },
                    on: function(a, b) {
                        f.add(a, b)
                    },
                    off: function(a, b) {
                        f.remove(a, b)
                    }
                };
            return c(), l
        }
        var b = $AJB.lib.addEvent(),
            c = $AJB.lib.CustEvent(),
            d = $AJB.lib.util(),
            e = $AJB.lib["class"](),
            f = c(),
            g = 0,
            h = "start";
        return a
    }, $AJB.general.Switcher = function() {
        "use strict";

        function a(a, b, c) {
            var d, e, f = null,
                g = !1,
                h = {
                    point: [0, 0],
                    enabled: !1,
                    color: "#c8c8c8",
                    update: function() {
                        var a = h.point,
                            c = 30;
                        h.enabled && (0 === e ? (d = h.color, a[0] < b / 2 ? (a[0] = Math.min(a[0] + c, b / 2), h.point = a) : (h.point = a, g = !0)) : 1 === e && (d = "#000", a[0] > b / 2 ? (a[0] = Math.max(a[0] - c, b / 2), h.point = a) : (h.point = a, g = !0)))
                    },
                    render: function() {
                        var e = h.point;
                        h.enabled && (a.fillStyle = d, a.fillRect(e[0] - b / 2, e[1] - c / 2, b, c), g && (h.enabled = !1, f && f()))
                    },
                    switchStage: function(d, i) {
                        0 === d ? h.point = [-b / 2, c / 2] : 1 === d && (a.fillStyle = h.color, a.fillRect(0, 0, b, c), h.point = [b + b / 2, c / 2]), h.enabled = !0, g = !1, e = d, f = i
                    }
                };
            return h
        }
        return a
    }, $AJB.lib.addEvent = function() {
        var a = $AJB.lib.util(),
            b = {
                click: "touchstart",
                mousedown: "touchstart",
                mouseup: "touchend"
            };
        return function(c, d, e, f) {
            c.addEventListener ? c.addEventListener(a.isMobile ? b[d] || d : d, e, f) : c.attachEvent ? c.attachEvent("on" + d, e) : c["on" + d] = e
        }
    }, $AJB.general.Levels = function() {
        "use strict";

        function a(a, b) {
            return function() {
                var c = 0;
                return function() {
                    return c += a * b % 360
                }
            }
        }

        function b(a, b) {
            return function() {
                var c = 0,
                    d = 1,
                    e = +new Date;
                return function() {
                    var f = +new Date;
                    return f - e > b && (d = -d, e = f), c += d * a % 360
                }
            }
        }

        function c(a, b, c, d) {
            return function() {
                var e = 0,
                    f = +new Date;
                return function() {
                    var g = +new Date;
                    return g - f > c && (a = b - a, f = g), e += a * d % 360
                }
            }
        }

        function d(a, b) {
            var c = 1,
                d = {
                    "-1": b,
                    1: a
                },
                e = b ? d[c] : a;
            return i(document.body, "mousedown", function() {
                    c = -c, e = b ? d[c] : a
                }),
                function() {
                    var a = 0;
                    return function() {
                        return a += e * c % 360
                    }
                }
        }

        function e(a, b, c, d) {
            return i(document.body, "mousedown", function() {
                    d = -d
                }),
                function() {
                    var e = 0,
                        f = +new Date;
                    return function() {
                        var g = +new Date;
                        return g - f > c && (a = b - a, f = g), e += a * d % 360
                    }
                }
        }

        function f(a, b, c, d) {
            return function() {
                var e = 0,
                    f = +new Date,
                    g = 0,
                    h = [
                        [a, c],
                        [b, d]
                    ],
                    i = 1;
                return function() {
                    var a = +new Date,
                        b = h[g][0];
                    return a - f > h[g][1] && (b = h[g][0], g = (g + 1) % 2, f = +new Date, i = -i), e += i * b
                }
            }
        }

        function g(a, b, c, d) {
            j[a] = {
                childs: l[b],
                queueCount: c,
                round: k[d]
            }
        }
        var h, i = $AJB.lib.addEvent(),
            j = {},
            k = {
                A1: a(1.5, 1),
                A2: a(1.5, -1),
                B1: a(2.5, 1),
                B2: a(2.5, -1),
                C1: b(2.2, 3e3),
                C2: b(3.5, 2e3),
                D1: c(2, 2.3, 1200, 1),
                D2: c(2, 2.3, 1200, -1),
                D3: c(4, 4.5, 700, 1),
                D4: c(4, 4.5, 700, -1),
                D5: c(4, 4.5, 1700, 1),
                D6: c(4, 4.5, 1700, -1),
                E1: d(2),
                E2: e(2, 2.3, 1e3, 1),
                E3: e(2, 2.5, 1e3, 1),
                E4: d(3, 2),
                E5: d(1.5, 3.2),
                F1: f(2, .3, 200, 300),
                F2: f(3.5, 1, 250, 1500),
                F3: f(.5, 1.8, 350, 1500),
                F4: f(1.8, .5, 1e3, 150),
                F5: f(.5, 2.2, 350, 1500)
            },
            l = {
                0: [],
                2: [0, 180],
                3: [0, 120, 240],
                4: [0, 90, 180, 270],
                5: [0, 72, 144, 216, 288],
                6: [0, 60, 120, 180, 240, 300],
                7: [0, 52, 103, 155, 206, 258, 309],
                8: [0, 45, 90, 135, 180, 225, 270, 315],
                9: [0, 40, 80, 120, 160, 200, 240, 280, 320],
                10: [0, 36, 72, 108, 144, 180, 216, 252, 288, 324],
                11: [0, 33, 66, 99, 131, 164, 197, 230, 262, 295, 328],
                12: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
                13: [0, 28, 56, 84, 111, 139, 167, 194, 222, 250, 277, 305, 333],
                14: [0, 26, 52, 78, 103, 129, 155, 180, 206, 232, 258, 283, 309, 335],
                15: [0, 24, 48, 72, 96, 120, 144, 168, 192, 216, 240, 264, 288, 312, 336],
                16: [0, 23, 45, 68, 90, 113, 135, 158, 180, 203, 225, 248, 270, 293, 315, 338]
            },
            m = {
                1: ["4", 8, "A1"],
                2: ["6", 10, "A1"],
                3: ["2", 20, "A1"],
                4: ["8", 12, "A2"],
                5: ["12", 8, "A1"],
                6: ["10", 10, "A2"],
                7: ["11", 12, "A1"],
                8: ["14", 6, "A2"],
                9: ["0", 26, "A2"],
                10: ["14", 10, "A1"],
                11: ["10", 8, "B1"],
                12: ["6", 12, "B2"],
                13: ["12", 4, "B1"],
                14: ["8", 14, "B2"],
                15: ["8", 6, "B1"],
                16: ["5", 10, "B2"],
                17: ["6", 12, "B1"],
                18: ["8", 14, "B2"],
                19: ["0", 23, "B1"],
                20: ["10", 13, "B2"],
                21: ["4", 12, "C1"],
                22: ["6", 10, "C1"],
                23: ["8", 12, "C1"],
                24: ["7", 14, "C1"],
                25: ["2", 18, "C1"],
                26: ["4", 18, "C1"],
                27: ["0", 24, "C1"],
                28: ["4", 10, "C2"],
                29: ["6", 13, "C2"],
                30: ["4", 20, "C1"],
                31: ["6", 8, "D1"],
                32: ["2", 12, "D2"],
                33: ["3", 14, "D2"],
                34: ["3", 18, "D1"],
                35: ["8", 12, "D1"],
                36: ["7", 15, "D2"],
                37: ["16", 8, "D2"],
                38: ["0", 23, "D1"],
                39: ["12", 12, "D1"],
                40: ["12", 15, "D2"],
                41: ["5", 10, "E1"],
                42: ["6", 12, "E1"],
                43: ["3", 15, "E1"],
                44: ["3", 19, "E1"],
                45: ["0", 24, "E1"],
                46: ["2", 15, "E2"],
                47: ["4", 16, "E2"],
                48: ["12", 8, "E2"],
                49: ["3", 20, "E2"],
                50: ["16", 14, "E3"],
                51: ["6", 10, "D3"],
                52: ["2", 18, "D4"],
                53: ["8", 14, "D3"],
                54: ["0", 24, "D4"],
                55: ["4", 21, "D3"],
                56: ["16", 16, "A1"],
                57: ["4", 22, "C1"],
                58: ["4", 26, "D1"],
                59: ["4", 25, "E2"],
                60: ["12", 14, "E2"],
                61: ["10", 11, "F1"],
                62: ["4", 21, "F1"],
                63: ["8", 16, "F1"],
                64: ["2", 24, "F1"],
                65: ["16", 8, "F1"],
                66: ["12", 14, "F2"],
                67: ["8", 19, "F2"],
                68: ["3", 21, "F2"],
                69: ["0", 32, "F2"],
                70: ["8", 20, "F1"],
                71: ["12", 12, "F5"],
                72: ["8", 18, "F3"],
                73: ["15", 15, "F5"],
                74: ["3", 18, "F3"],
                75: ["3", 22, "F5"],
                76: ["5", 22, "F4"],
                77: ["6", 21, "F4"],
                78: ["9", 18, "F4"],
                79: ["8", 21, "F4"],
                80: ["6", 24, "F4"],
                81: ["5", 12, "E4"],
                82: ["7", 14, "E4"],
                83: ["2", 21, "E4"],
                84: ["0", 24, "E4"],
                85: ["7", 16, "E4"],
                86: ["12", 13, "E5"],
                87: ["4", 15, "E5"],
                88: ["5", 19, "E5"],
                89: ["8", 18, "E4"],
                90: ["16", 16, "E4"]
            };
        for (h in m) g(h, m[h][0], m[h][1], m[h][2]);
        return j
    }, $AJB.general.Collide = function() {
        "use strict";
        var a = $AJB.lib.util(),
            b = {
                check: function(b, c, d) {
                    var e = b.childs(),
                        f = e.length,
                        g = Math.ceil(2 * c.rad());
                    for (d = d || 1; f--;)
                        if (c !== e[f].ball && a.getPointDistance(c.pos(), e[f].ball.pos()) <= g + Math.ceil(2 * d)) return !0;
                    return !1
                }
            };
        return b
    }, $AJB.general.Tween = function() {
        "use strict";
        var a = {
            simple: function(b, c, d, e) {
                var f = (c - b) / e,
                    g = +new Date;
                return e > g - d ? (a.isEnd = !1, b + (g - d) * f) : (a.isEnd = !0, c)
            },
            isEnd: !0
        };
        return a
    }, $AJB.general.BallQueue = function() {
        "use strict";

        function a(a, f, g, h, i) {
            function j() {
                var b, d, e = k(a),
                    j = e.length;
                for (b = 0; j > b; b++) d = c(h, null, e[b], null, i, 1), d.pos(f, g + 3 * d.rad() * b), m.push(d)
            }

            function k(a) {
                for (var b = a, c = []; b--;) c.push(b + 1);
                return c
            }
            var l, m = [],
                n = [],
                o = b();
            return i = i || 1, l = {
                ballList: m,
                add: function() {},
                remove: function(a) {
                    var b = m[a];
                    return m.splice(a, 1), b
                },
                clear: function() {
                    n = [], m = []
                },
                popup: function() {
                    var a = m.shift();
                    a.st = +new Date, a.sv = a.pos().y, n.push(a)
                },
                update: function() {
                    var a, b, c, h = n.length,
                        i = m.length;
                    if (h) {
                        for (b = n[0].rad(), a = g - 3 * b; h--;) n[h].pos(f, d.simple(n[h].sv, a, n[h].st, 50)), c = n[n.length - 1].pos().y, n[h].pos().y === a && (o.fire(e, n[h]), n.splice(h, 1));
                        for (; i--;) m[i].pos(f, c + 3 * b * (i + 1))
                    }
                },
                render: function() {
                    for (var a = m.length, b = n.length; a--;) m[a].render();
                    for (; b--;) n[b].render()
                },
                on: function(a, b) {
                    o.add(a, b)
                },
                off: function(a, b) {
                    o.remove(a, b)
                },
                destroy: function() {
                    for (var a = m.length; a--;) m[a].destroy();
                    o.destroy()
                }
            }, j(), l
        }
        var b = $AJB.lib.CustEvent(),
            c = $AJB.general.Ball(),
            d = $AJB.general.Tween(),
            e = "popup";
        return a
    }, $AJB.general.Ball = function() {
        "use strict";

        function a(a, c, d, e, f, g) {
            function h() {
                var c = b.getTextWidth(a, 0, 0, d, e);
                b.drawText(a, j - c / 2, k + e / 3, d, e, "black")
            }
            var i, j = 0,
                k = 0;
            return f = f || 2, g = g || 1, c = (c || 12) * f, e = (e || 15) * f, i = {
                pos: function(a, b) {
                    return "undefined" != typeof a && (j = a), "undefined" != typeof b && (k = b), {
                        x: j,
                        y: k
                    }
                },
                scale: function(a) {
                    return "undefined" != typeof a && (f = a), f
                },
                rad: function(a) {
                    return "undefined" != typeof a && (c = a), c
                },
                distance: function(a) {
                    return "undefined" != typeof a && (g = a), g
                },
                render: function(e) {
                    b.drawCircle(a, j, k, c, "#ffffff"), "undefined" != typeof d ? h(d) : "undefined" != typeof e && h(e)
                },
                destroy: function() {
                    i = null
                }
            }
        }
        var b = $AJB.lib.util();
        return a
    }, $AJB.lib.util = function() {
        "use strict";
        return {
            drawRing: function(a, b, c, d, e) {
                a.beginPath(), a.arc(b, c, d, 0, 2 * Math.PI, !1), a.strokeStyle = e || "red", a.closePath(), a.stroke()
            },
            drawCircle: function(a, b, c, d, e) {
                a.beginPath(), a.arc(b, c, d, 0, 2 * Math.PI, !1), a.fillStyle = e || "red", a.fill()
            },
            drawLine: function(a, b, c, d, e, f, g) {
                a.strokeStyle = f || "red", a.lineWidth = g || 1, a.beginPath(), a.moveTo(b, c), a.lineTo(d, e), a.stroke()
            },
            drawText: function(a, b, c, d, e, f) {
                a.font = e + "px Verdana", a.fillStyle = f || "red", a.fillText(d, b, c)
            },
            getTextWidth: function(a, b, c, d, e, f) {
                return a.font = e + "px Verdana", a.fillStyle = f || "red", a.measureText(d).width
            },
            getPointDistance: function(a, b) {
                return Math.floor(Math.sqrt(Math.floor(Math.pow(a.x - b.x, 2)) + Math.floor(Math.pow(a.y - b.y, 2))))
            },
            getOpenid: function() {
                var a = new RegExp("[?&]openid=([^?&]*)[&]?", "i"),
                    b = window.location.search.match(a);
                return null == b ? "" : b[1], b ? b[1] : ""
            },
            getUA: function() {
                return navigator.userAgent
            },
            isMobile: /(mobile|iphone|ipod|ipad|ios|android|windows phone)/i.test(navigator.userAgent),
            isAndroid: /android/i.test(navigator.userAgent),
            isWeixin: /MicroMessenger/i.test(navigator.userAgent)
        }
    }, $AJB.general.Core = function() {
        "use strict";

        function a(a, d, e, f, g) {
            function h() {
                for (var a, b, c, d, e = n.length; e--;) a = 3 * Math.cos((n[e].angle + k.angle()) * Math.PI / 180) * o * g * n[e].ball.distance() + p, b = 3 * Math.sin((n[e].angle + k.angle()) * Math.PI / 180) * o * g * n[e].ball.distance() + q, c = a / Math.abs(a), d = b / Math.abs(b), n[e].ball.pos(a, b)
            }

            function i() {
                m -= .0015, (Math.abs(m) <= .7 || Math.abs(m) >= 1) && (m *= -1)
            }
            var j, k, l = 0,
                m = 1,
                n = [],
                o = 50,
                p = a.width / 2,
                q = 4 * o * g;
            return g = g || 1, j = c(d, o, e, f, g), j.pos(p, q), k = {
                pos: j.pos,
                scale: j.scale,
                rad: j.rad,
                angle: function(a) {
                    return "undefined" != typeof a && (l = a), l
                },
                ringScale: function(a) {
                    return "undefined" != typeof a && (m = a), m
                },
                addChild: function(a, b) {
                    n.push({
                        angle: a,
                        ball: b
                    })
                },
                clear: function() {
                    n = []
                },
                childs: function() {
                    return n
                },
                update: function() {
                    i(), h()
                },
                render: function() {
                    var c, e = n.length,
                        f = a.width,
                        h = a.height;
                    for (d.clearRect(0, 0, f, h), c = 0; e > c; c++) b.drawLine(d, p, q, n[c].ball.pos().x, n[c].ball.pos().y, "#ffffff", 1.5 * g), n[c].ball.render();
                    j.render()
                },
                destroy: function() {
                    k.clear(), j = null, k = null
                }
            }
        }
        var b = $AJB.lib.util(),
            c = $AJB.general.Ball();
        return a
    }, $AJB.lib.CustEvent = function() {
        return function(a) {
            function b(a) {
                return Object.prototype.toString.call(a).slice(8, -1).toLowerCase()
            }
            var c = {};
            return !a && (a = {}), {
                add: function(a, d) {
                    if ("function" === b(d)) {
                        var e = c;
                        a = a.toLowerCase(), !e[a] && (e[a] = []), e[a].push(d)
                    }
                },
                remove: function(a, d) {
                    var e, f = c[a];
                    if (a = a.toLowerCase(), "function" === b(d) && f && f.length)
                        for (e = f.length - 1; e >= 0; e--) f[e] === d && f.splice(e, 1)
                },
                fire: function(b) {
                    var d, e, f, g;
                    if (b = b.toLowerCase(), d = c[b], d && d.length)
                        for (e = Array.prototype.slice.call(arguments, 1), g = d.length, f = 0; g > f; f++) d[f].apply(a, e)
                },
                destroy: function() {
                    var a, b = c.length - 1;
                    for (a = b; a >= 0; a--) evts.splice(a, 1)
                }
            }
        }
    }, $AJB.general.Scene = function() {
        "use strict";

        function a(a, b, l, m) {
            function n(a) {
                var g = a.childs,
                    h = g.length;
                for (y = a.round(), w && w.destroy(), w = c(b, l, B, 50, m); h--;) w.addChild(g[h], d(l, null, "", null, m));
                x && x.destroy(), x = e(a.queueCount, b.width / 2, w.pos().y + 4 * w.rad(), l, m), x.on("popup", function(a) {
                    w.addChild(90 - w.angle(), a), f.check(w, a, m) ? (z = a, s()) : !x.ballList.length && r()
                }), x.on("collide", function(a) {
                    f.check(w, a, m) ? (z = a, s()) : !x.ballList.length && r()
                })
            }

            function o() {
                y && (w.angle(y()), w.update(), x.update())
            }

            function p() {
                var b, c, d, e, f = w.childs(),
                    g = f.length,
                    h = 25;
                for (a.style.backgroundColor = u.bgColor; g--;) b = f[g].angle + w.angle(), c = Math.cos(b * Math.PI / 180) * h, d = Math.sin(b * Math.PI / 180) * h, e = f[g].ball.pos(), f[g].ball.pos(e.x + c, e.y + d)
            }

            function q(a) {
                var b, c = [25, 15, 20, 15],
                    d = c.length,
                    e = 200,
                    f = e / d;
                for (w.update(), b = 1; d >= b; b++) a > f * b && z.rad(c[b - 1] * m)
            }

            function r() {
                "pass" !== A && (a.style.backgroundColor = "#1CB01A", A = "pass", v = +new Date)
            }

            function s() {
                "fail" !== l && (a.style.backgroundColor = "#B8111C", A = "fail", v = +new Date)
            }

            function t() {
                var a = "to be continued...",
                    c = h.getTextWidth(l, 0, 0, a, 30 * m);
                h.drawText(l, (b.width - c) / 2, 200 * m, a, 30 * m, "yellow")
            }
            var u, v, w, x, y, z, A = "run",
                B = 1;
            return u = {
                enabled: !1,
                run: function(b) {
                    var c = g[b];
                    B = b, c ? (u.enabled = !0, n(c), a.style.backgroundColor = "#000", A = "run") : t()
                },
                shot: function() {
                    x && x.ballList.length && x.popup(w)
                },
                update: function() {
                    var a;
                    u.enabled && ("run" === A ? o() : "pass" === A ? (p(), +new Date - v > 1e3 && (A = "", k.fire(i))) : "fail" === A && (a = +new Date - v, q(a), a > 1e3 && (A = "", k.fire(j))))
                },
                render: function() {
                    u.enabled && (w.render(), x.render())
                },
                on: function(a, b) {
                    k.add(a, b)
                },
                off: function(a, b) {
                    k.remove(a, b)
                }
            }
        }
        var b = $AJB.lib.CustEvent(),
            c = $AJB.general.Core(),
            d = $AJB.general.Ball(),
            e = $AJB.general.BallQueue(),
            f = $AJB.general.Collide(),
            g = $AJB.general.Levels(),
            h = $AJB.lib.util(),
            i = "passed",
            j = "failed",
            k = b();
        return a
    }, $AJB.general.Game = function() {
        "use strict";

        function a() {
            var a = document.body.scrollWidth || document.documentElement.scrollWidth,
                b = document.body.scrollHeight || document.documentElement.scrollHeight;
            A.width = a, A.height = b, m = q(N, a, b), B.style.backgroundColor = m.color, B.style.width = a + "px", B.style.height = b + "px", n = b / 560
        }

        function b() {
            C.href = R.replace(/#\{level\}/, W)
        }

        function c() {
            v.isWeixin ? t(C, "mousedown", function() {
                D.style.display = ""
            }) : v.isMobile && b()
        }

        function d() {
            t(H, "mousedown", function() {
                y.show(I)
            }), t(K, "mousedown", function() {
                y.hide(I)
            }), t(M, "mousedown", function() {
                y.removeClass(B.getElementsByClassName("page")[Y++], "show"), y.addClass(B.getElementsByClassName("page")[Y], "show"), y.show(L), 2 == Y && y.hide(M)
            }), t(L, "mousedown", function() {
                y.removeClass(B.getElementsByClassName("page")[Y--], "show"), y.addClass(B.getElementsByClassName("page")[Y], "show"), y.show(M), 0 == Y && y.hide(L)
            }), t(E, "mousedown", function() {
                v.isWeixin ? (ga("send", {
                    hitType: "event",
                    eventCategory: "prepay",
                    eventAction: "level_" + W,
                    eventLabel: v.getOpenid(),
                    eventValue: 1
                }), h()) : z.popup("在微信中打开可使用跳关")
            }), t(J, "mousedown", function() {
                z.popup("检测用户状态..."), s.is_subscribe(v.getOpenid(), function(a) {
                    1 == a ? (z.popup("开始同步云端关卡..."), s.load(v.getOpenid(), function(a) {
                        var a = JSON.parse(a);
                        a.level && a.level > W ? (e(a.level), z.popup("云端关卡同步完毕！")) : s.save(W)
                    })) : z.popup(v.isWeixin ? "关注“点石互动”(pointstone)开启云端存关" : "在微信中打开可开启云端存关")
                })
            })
        }

        function e(a) {
            W = +a, u.setValue(P, W), document.title = Q.replace(/\#\{level\}/, W), V.level(W, Y), !v.isWeixin && v.isMobile && b()
        }

        function f() {
            t(document.body, "mousedown", function(a) {
                var b;
                if (a && a.changedTouches)
                    for (b = a.changedTouches.length; b--;) l.shot();
                else l.shot();
                "1" != a.target.getAttribute("data-capture") && w(a)
            }), l.on("passed", function() {
                m.switchStage(0, function() {
                    l.enabled = !1, o == W && e(W + 1), A.style.display = "none", y.hide(G), V.show(), o == W - 1 && s.save(W), ga("send", {
                        hitType: "event",
                        eventCategory: "passed",
                        eventAction: "level_" + W,
                        eventLabel: v.getOpenid(),
                        eventValue: 1
                    })
                })
            }), l.on("failed", function() {
                m.switchStage(0, function() {
                    l.enabled = !1, A.style.display = "none", V.level(W, Y), V.show(), ga("send", {
                        hitType: "event",
                        eventCategory: "failed",
                        eventAction: "level_" + W,
                        eventLabel: v.getOpenid(),
                        eventValue: 1
                    })
                })
            }), V.on("start", function(a) {
                o = a ? a : W, A.style.display = "", V.hide(), m.switchStage(1, function() {
                    l.run(o)
                })
            })
        }

        function g() {
            window.clearTimeout(X), l.update(), l.render(), m.update(), m.render(), X = window.setTimeout(g, 1e3 / O)
        }

        function h() {
            F.style.display = "", x.post("http://timelineapp.pointstone.org/wxpay-php/wxpayapi.php", {
                openid: v.getOpenid(),
                level: W
            }, function(a) {
                var b = JSON.parse(a),
                    c = b.total_fee / 100;
                y.hide(F), y.show(G), G.innerHTML = "支付" + c + "元，跳过本关", G.addEventListener("touchstart", function() {
                    wx.chooseWXPay({
                        timestamp: b.timeStamp,
                        nonceStr: b.nonceStr,
                        "package": b["package"],
                        signType: b.signType,
                        paySign: b.paySign,
                        success: function() {
                            if (ga("send", {
                                    hitType: "event",
                                    eventCategory: "payed",
                                    eventAction: "level_" + W,
                                    eventLabel: "",
                                    eventValue: 1
                                }), G.style.display = "none", G.innerHTML = "", W++, window.localStorage) {
                                var a = window.localStorage;
                                a.setItem("core-ball-level", W), window.location.reload()
                            }
                        },
                        cancel: function() {
                            G.style.display = "none", G.innerHTML = ""
                        }
                    })
                })
            })
        }

        function i(a) {
            wx.config({
                debug: !1,
                appId: a.appid,
                timestamp: a.timestamp,
                nonceStr: a.noncestr,
                signature: a.signature,
                jsApiList: ["checkJsApi", "onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareWeibo", "hideMenuItems", "showMenuItems", "hideAllNonBaseMenuItem", "showAllNonBaseMenuItem", "translateVoice", "startRecord", "stopRecord", "onRecordEnd", "playVoice", "pauseVoice", "stopVoice", "uploadVoice", "downloadVoice", "chooseImage", "previewImage", "uploadImage", "downloadImage", "getNetworkType", "openLocation", "getLocation", "hideOptionMenu", "showOptionMenu", "closeWindow", "scanQRCode", "chooseWXPay", "openProductSpecificView", "addCard", "chooseCard", "openCard"]
            }), wx.ready(function() {
                wx.onMenuShareAppMessage({
                    title: "Core Ball全新关卡，我已玩到第" + W + "关了，你也来试试吧！",
                    desc: "Core Ball全新关卡，我已玩到第" + W + "关了，你也来试试吧！",
                    link: S,
                    imgUrl: U,
                    trigger: function() {},
                    success: function() {
                        var a = new Object;
                        a.openid = v.getOpenid(), a.shareLevel = W, ga("send", {
                            hitType: "event",
                            eventCategory: "wx",
                            eventAction: "onMenuShareAppMessage_" + v.getOpenid(),
                            eventLabel: JSON.stringify(a),
                            eventValue: 1
                        })
                    },
                    cancel: function() {
                        alert("已取消")
                    },
                    fail: function(a) {
                        alert(JSON.stringify(a))
                    }
                }), wx.onMenuShareTimeline({
                    title: "Core Ball全新关卡，我已玩到第" + W + "关了，你也来试试吧！",
                    link: T,
                    imgUrl: U,
                    trigger: function() {},
                    success: function() {
                        var a = new Object;
                        a.openid = v.getOpenid(), a.shareLevel = W, ga("send", {
                            hitType: "event",
                            eventCategory: "wx",
                            eventAction: "onMenuShareAppMessage_" + v.getOpenid(),
                            eventLabel: JSON.stringify(a),
                            eventValue: 1
                        })
                    },
                    cancel: function() {},
                    fail: function() {}
                })
            })
        }

        function j() {
            v.isWeixin ? x.post("http://timelineapp.pointstone.org/ci/authorize/get_jssdk_info", {
                url: window.location.href
            }, function(a) {
                var b = JSON.parse(a);
                b.sess_openid != v.getOpenid() && (/*location.href = S*/1), s.load(v.getOpenid(), function(a) {
                    var a = JSON.parse(a);
                    a.level && a.level > W ? (e(a.level), z.popup("云端关卡同步完毕！")) : s.save(W)
                }), i(b)
            }) : location.search && (1/*location.href = location.pathname*/)
        }

        function k() {
            ga("send", {
                hitType: "event",
                eventCategory: "UA",
                eventAction: v.getUA(),
                eventLabel: "",
                eventValue: 1
            }), a(), l = p(document.body, A, N, n), f(), c(), d(), j(), V.level(W), V.show(), g()
        }
        var l, m, n, o, p = $AJB.general.Scene(),
            q = $AJB.general.Switcher(),
            r = $AJB.general.BeginStage(),
            s = $AJB.general.GameInfo(),
            t = $AJB.lib.addEvent(),
            u = $AJB.lib.Storage(),
            v = $AJB.lib.util(),
            w = $AJB.lib.stopEvent(),
            x = $AJB.lib.ajax(),
            y = $AJB.lib["class"](),
            z = $AJB.lib.tip(),
            A = document.getElementById("stage"),
            B = document.getElementById("begin"),
            C = document.getElementById("btnFW"),
            D = (document.getElementById("btnReset"), document.getElementById("wxArrow")),
            E = document.getElementById("btnJump"),
            F = document.getElementById("tipJump"),
            G = document.getElementById("payBtn"),
            H = document.getElementById("chooseLevel"),
            I = document.getElementById("chooseBlockWindow"),
            J = document.getElementById("loadLevel"),
            K = document.getElementById("back"),
            L = document.getElementById("pre"),
            M = document.getElementById("next"),
            N = A.getContext("2d"),
            O = 60,
            P = "core-ball-level",
            Q = "coreball，我已玩到第#{level}关了!",
            R = "sinaweibo://share?content=Core Ball，我已玩到第#{level}关了，你也来试试吧！ http://timelineapp.pointstone.org/coreball/",
            S = "http://timelineapp.pointstone.org/coreball/",
            T = "http://mp.weixin.qq.com/s?__biz=MzA5MTI2MjQyOA==&mid=204808432&idx=1&sn=5818f054b1aa42c8f6fa0337757884cd#rd",
            U = "http://timelineapp.pointstone.org/coreball/image/icon.png",
            V = r(B),
            W = +u.getValue(P) || 1,
            X = 0,
            Y = 0,
            Z = {
                start: k
            };
        return Z
    }, $AJB.page.index = function() {
        "use strict";
        var a = $AJB.general.Game();
        a.start()
    }, $AJB.page.index();